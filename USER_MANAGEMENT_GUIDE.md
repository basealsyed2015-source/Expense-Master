# ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุงููุงูู - ููุตุฉ ุญุงุณุจุฉ ุงูุชูููู

## ๐ ููุฎุต ุงููุธุงู

ุชู ุฅุนุงุฏุฉ ุจูุงุก ูุธุงู ุงูุตูุงุญูุงุช ูู ุงูุตูุฑ ูุชูููุฐ ูุธุงู ุฅุฏุงุฑุฉ ูุณุชุฎุฏููู ูุงูู ูุน ุนูููุงุช CRUD (ุฅูุดุงุกุ ูุฑุงุกุฉุ ุชุนุฏููุ ุญุฐู) ูุฃุฑุจุน ุฃุฏูุงุฑ ูุงุถุญุฉ.

---

## โ ุงูููุฒุงุช ุงูููููููุฐุฉ

### 1. **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู (User Management)**
#### ๐ ุนุฑุถ ูุงุฆูุฉ ุงููุณุชุฎุฏููู
- **ุงูุฑุงุจุท**: `/admin/users`
- **ุงูููุฒุงุช**:
  - ุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู ูู ุฌุฏูู ููุธู
  - ุงูุจุญุซ ูุงูููุชุฑุฉ (ุญุณุจ: ุงุณู ุงููุณุชุฎุฏูุ ุงูุงุณู ุงููุงููุ ุงูุจุฑูุฏ)
  - ุนุฑุถ ุงูุฏูุฑุ ุงูุดุฑูุฉุ ูุงูุญุงูุฉ (ูุดุท/ุบูุฑ ูุดุท)
  - ุชุตุฏูุฑ ุงูุจูุงูุงุช ุฅูู Excel/CSV
  - ุฃุฒุฑุงุฑ: ุฅุถุงูุฉ ุฌุฏูุฏุ ุชุตุฏูุฑ

#### ๐ค ุนุฑุถ ูุณุชุฎุฏู ูุญุฏุฏ
- **ุงูุฑุงุจุท**: `/admin/users/:id`
- **ุงูููุฒุงุช**:
  - ุนุฑุถ ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ ูุงููุฉ
  - ุนุฑุถ ุงูุตูุงุญูุงุช ูุงููุนูููุงุช ุงููุธูููุฉ
  - ุนุฑุถ ุงูุดุฑูุฉ ุงููุฑุชุจุทุฉ
  - ุงูุญุงูุฉ (ูุดุท/ุบูุฑ ูุดุท)
  - ุชุงุฑูุฎ ุงูุฅูุดุงุก ูุขุฎุฑ ุชุณุฌูู ุฏุฎูู
  - ุฃุฒุฑุงุฑ: ุชุนุฏููุ ุตูุงุญูุงุชุ ุญุฐู

#### โ๏ธ ุชุนุฏูู ูุณุชุฎุฏู
- **ุงูุฑุงุจุท**: `/admin/users/:id/edit`
- **ุงูููุฒุงุช**:
  - ุชุนุฏูู ุฌููุน ุงููุนูููุงุช (ุงุณู ุงููุณุชุฎุฏูุ ุงูุงุณู ุงููุงููุ ุงูุจุฑูุฏุ ุงูุฌูุงู)
  - **ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุงุฎุชูุงุฑู** (ุงุชุฑู ุงูุญูู ูุงุฑุบุงู ูุนุฏู ุงูุชุบููุฑ)
  - ุชุบููุฑ ุงูุฏูุฑ (role_id) ูุน ููุชุฑุฉ ุฏููุงููููุฉ ุญุณุจ ููุน ุงููุณุชุฎุฏู
  - ุชุนููู/ุชุบููุฑ ุงูุดุฑูุฉ (tenant_id)
  - ุชูุนูู/ุชุนุทูู ุงูุญุณุงุจ
- **ูุนุงูุฌุฉ**: `POST /admin/users/:id`
- **ุงูุชุญูู**: ุฑุณุงูุฉ ูุฌุงุญ + ุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ

#### ๐๏ธ ุญุฐู ูุณุชุฎุฏู
- **ุงูุฑุงุจุท**: `/admin/users/:id/delete`
- **ุงูููุฒุงุช**:
  - ุชุฃููุฏ ุงูุญุฐู ุจูุงูุฐุฉ ููุจุซูุฉ
  - ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ ูุน ุงุณู ุงููุณุชุฎุฏู ุงููุญุฐูู
  - ุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ ููุงุฆูุฉ ุงููุณุชุฎุฏููู

---

## ๐ญ ุงูุฃุฏูุงุฑ ุงูุฃุฑุจุนุฉ (4-Role System)

### **Role 1: Super Admin (ุงููุฏูุฑ ุงูุนุงู)**
- **ุงุณู ุงููุณุชุฎุฏู**: `superadmin`
- **ูููุฉ ุงููุฑูุฑ**: `Super@2025`
- **ุงูุตูุงุญูุงุช**:
  - โ ุฑุคูุฉ ุฌููุน ุงูุดุฑูุงุช ูุงูุจูุงูุงุช
  - โ ุฅุฏุงุฑุฉ SaaS (ุงูุงุดุชุฑุงูุงุชุ ุงูุญุฒูุ ุงูุจููู)
  - โ ุฅุฏุงุฑุฉ ุฌููุน ุงููุณุชุฎุฏููู
  - โ ุนุฑุถ ูุชุนุฏูู ุฌููุน ุงูุนููุงุก ูุงูุทูุจุงุช
  - โ ุงููุตูู ููุงูุฉ ุฅุญุตุงุฆูุงุช ุงููุธุงู

### **Role 4: Company Admin (ูุฏูุฑ ุงูุดุฑูุฉ)**
- **ุงุณู ุงููุณุชุฎุฏู**: `companyadmin`
- **ูููุฉ ุงููุฑูุฑ**: `Company@2025`
- **ุงูุตูุงุญูุงุช**:
  - โ ุฅุฏุงุฑุฉ ุจูุงูุงุช ุดุฑูุชู ููุท (tenant_id = 1)
  - โ ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุงูุนููุงุก ูุงูุทูุจุงุช
  - โ ุฅุฏุงุฑุฉ ุงูููุธููู ูุงููุดุฑููู ูู ุดุฑูุชู
  - โ ุชูุฒูุน ุงูุนููุงุก ุนูู ุงูููุธููู
  - โ ูุง ูุฑู ุจูุงูุงุช ุดุฑูุงุช ุฃุฎุฑู
  - โ ูุง ูุตู ูุฅุนุฏุงุฏุงุช SaaS

### **Role 5: Supervisor (ูุดุฑู ุงูููุธููู)**
- **ุงุณู ุงููุณุชุฎุฏู**: `supervisor`
- **ูููุฉ ุงููุฑูุฑ**: `Supervisor@2025`
- **ุงูุตูุงุญูุงุช**:
  - โ **ูุฑุงุกุฉ ููุท** ูุฌููุน ุนููุงุก ูุทูุจุงุช ุงูุดุฑูุฉ
  - โ ุนุฑุถ ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช
  - โ **ูุง ููููู**: ุงูุฅุถุงูุฉุ ุงูุชุนุฏููุ ุงูุญุฐู
  - โ ูุง ููููู ุชูุฒูุน ุงูุนููุงุก

### **Role 3: Employee (ุงูููุธู)**
- **ุงุณู ุงููุณุชุฎุฏู**: `employee`
- **ูููุฉ ุงููุฑูุฑ**: `Employee@2025`
- **ุงูุตูุงุญูุงุช**:
  - โ ุฑุคูุฉ ุงูุนููุงุก **ุงููุฎุตุตูู ูู ููุท** (assigned_to = user_id)
  - โ ุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุชูููู ุงูุฎุงุตุฉ ุจุนููุงุฆู
  - โ ูุง ูุฑู ุนููุงุก ุฒููุงุฆู
  - โ ูุง ูุตู ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู

---

## ๐๏ธ ุงูุชูุงุตูู ุงูุชูููุฉ

### **1. ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- **Migrations ุงููุทุจูุฉ**:
  - `0012_restructure_permissions.sql` - ููููุฉ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
  - `0013_dynamic_roles_system.sql` - ูุธุงู ุงูุฃุฏูุงุฑ ุงูุฏููุงูููู
  - `0014_add_test_users.sql` - ุฅุถุงูุฉ 4 ูุณุชุฎุฏููู ุงุฎุชุจุงุฑ

- **ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ**:
  ```sql
  users (id, username, password, full_name, email, phone, role_id, user_type, tenant_id, is_active)
  roles (id, role_name, description)
  role_permissions (role_id, permission_id)
  tenants (id, company_name, slug, status)
  ```

### **2. ุงูููุชุฑุฉ ุญุณุจ ุงูุฏูุฑ**
```typescript
// ูู getUserInfo() ูุฌููุน ุงูู routes:
if (roleId === 1) {
  // Super Admin - no WHERE clause (see all)
} else if (roleId === 4 || roleId === 5) {
  // Company Admin / Supervisor - WHERE tenant_id = ?
} else if (roleId === 3) {
  // Employee - WHERE assigned_to = ?
}
```

### **3. ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ ุญุณุจ ุงูุตูุงุญูุงุช**
```javascript
// Supervisor (Role 5) = Read-Only
const canEdit = roleId !== 5;

if (canEdit) {
  // Show Edit/Delete/Add buttons
} else {
  // Hide buttons
}
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### **ุฑุงุจุท ุงูุชุทุจูู ุงููุจุงุดุฑ**:
```
https://8080-iwirje2zy3fybezv7hkxu-b32ec7bb.sandbox.novita.ai
```

### **ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ**:

#### โ ุงุฎุชุจุงุฑ Super Admin
1. ุณุฌูู ุฏุฎูู: `superadmin` / `Super@2025`
2. ุงุฐูุจ ูู `/admin/users`
3. **ุชูููุน**: ุฑุคูุฉ **ุฌููุน** ุงููุณุชุฎุฏููู (8 ูุณุชุฎุฏููู)
4. **ุชูููุน**: ุฃุฒุฑุงุฑ ุชุนุฏูู/ุญุฐู **ูุฑุฆูุฉ** ูุฌููุน ุงููุณุชุฎุฏููู
5. ุฌุฑูุจ ุชุนุฏูู ุฃู ูุณุชุฎุฏู โ ูุฌุจ ุฃู ููุฌุญ
6. ุฌุฑูุจ ุญุฐู ูุณุชุฎุฏู ุงุฎุชุจุงุฑ โ ูุฌุจ ุฃู ููุฌุญ

#### โ ุงุฎุชุจุงุฑ Company Admin
1. ุณุฌูู ุฏุฎูู: `companyadmin` / `Company@2025`
2. ุงุฐูุจ ูู `/admin/users`
3. **ุชูููุน**: ุฑุคูุฉ **ูุณุชุฎุฏูู ุดุฑูุชู ููุท** (tenant_id = 1)
4. **ุชูููุน**: ุฃุฒุฑุงุฑ ุชุนุฏูู/ุญุฐู **ูุฑุฆูุฉ**
5. ุฌุฑูุจ ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ โ ูุฌุจ ุฃู ููุนูููู tenant_id = 1 ุชููุงุฆูุงู
6. **ุชูููุน**: ูุง ูุฑู `/admin/saas-settings` ุฃู `/admin/tenants`

#### โ ุงุฎุชุจุงุฑ Supervisor
1. ุณุฌูู ุฏุฎูู: `supervisor` / `Supervisor@2025`
2. ุงุฐูุจ ูู `/admin/users`
3. **ุชูููุน**: ุฑุคูุฉ **ูุณุชุฎุฏูู ุดุฑูุชู ููุท**
4. **ุชูููุน**: ุฃุฒุฑุงุฑ ุชุนุฏูู/ุญุฐู **ูุฎููุฉ** (Read-Only)
5. **ุชูููุน**: ุฒุฑ "ุฅุถุงูุฉ ุฌุฏูุฏ" **ูุฎูู**
6. ุฌุฑูุจ ุงูุฏุฎูู ูุฏููุงู ูู `/admin/users/2/edit` โ ูุฌุจ ุฃู ูุนุฑุถ ุงูุตูุญุฉ ููู POST ูุฌุจ ุฃู ููุดู

#### โ ุงุฎุชุจุงุฑ Employee
1. ุณุฌูู ุฏุฎูู: `employee` / `Employee@2025`
2. ุงุฐูุจ ูู `/admin/users`
3. **ุชูููุน**: **ูุฏ ูุง ูุฑู** ุตูุญุฉ ุงููุณุชุฎุฏููู (depends on permissions)
4. ุงุฐูุจ ูู `/admin/customers`
5. **ุชูููุน**: ุฑุคูุฉ **ุนููุงุฆู ุงููุฎุตุตูู ููุท**

---

## ๐ฆ ุงููููุงุช ุงูููุนุฏูููุฉ

```
src/index.tsx:
  - ุฅุถุงูุฉ GET /admin/users/:id (ุนุฑุถ ูุณุชุฎุฏู)
  - ุฅุถุงูุฉ GET /admin/users/:id/edit (ูููุฐุฌ ุชุนุฏูู)
  - ุฅุถุงูุฉ POST /admin/users/:id (ูุนุงูุฌุฉ ุชุนุฏูู)
  - ุฅุถุงูุฉ GET /admin/users/:id/delete (ุญุฐู ูุณุชุฎุฏู)

migrations/0013_dynamic_roles_system.sql:
  - ููููุฉ ูุธุงู ุงูุฃุฏูุงุฑ ุงูุฏููุงูููู

migrations/0014_add_test_users.sql:
  - ุฅุถุงูุฉ 4 ูุณุชุฎุฏููู ุงุฎุชุจุงุฑ

test_d123456.sh:
  - ุณูุฑูุจุช ุงุฎุชุจุงุฑ ุดุงูู (ูุฑุฌุนู)
```

---

## ๐ ุฎุทูุงุช ุงููุดุฑ ุนูู Hostinger

### **1. ุงูุงุชุตุงู ุจุงูุฎุงุฏู**
```bash
ssh -i ~/.ssh/hostinger root@195.248.240.214
cd /home/tamweelsa/Expense-Master
```

### **2. ุณุญุจ ุงูุชุญุฏูุซุงุช**
```bash
git pull origin genspark_ai_developer
npm install --production
```

### **3. ุชุทุจูู Migrations**
```bash
# ุชุทุจูู Migration 0012 (ุฅู ูู ููุทุจููู)
npx wrangler d1 execute tamweel-production --remote --file=./migrations/0012_restructure_permissions.sql

# ุชุทุจูู Migration 0013 (ูุธุงู ุงูุฃุฏูุงุฑ)
npx wrangler d1 execute tamweel-production --remote --file=./migrations/0013_dynamic_roles_system.sql

# ุชุทุจูู Migration 0014 (ุงููุณุชุฎุฏููู ุงูุงุฎุชุจุงุฑููู)
npx wrangler d1 execute tamweel-production --remote --file=./migrations/0014_add_test_users.sql
```

### **4. ุจูุงุก ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู**
```bash
npm run build
pm2 restart tamweel-app
pm2 logs tamweel-app --lines 50
```

### **5. ุงูุชุญูู ูู ุงููุดุฑ**
```bash
# ุชุญูู ูู ุงููุณุชุฎุฏููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
npx wrangler d1 execute tamweel-production --remote --command="SELECT id, username, role_id, tenant_id FROM users ORDER BY role_id"

# ุงุฎุชุจุฑ ุงูุฑุงุจุท ุงููุจุงุดุฑ
curl -I https://tamweel.sa/admin/users
```

---

## ๐ ุจูุงูุงุช ุงูุฏุฎูู ููุงุฎุชุจุงุฑ

| ุงูุฏูุฑ | ุงุณู ุงููุณุชุฎุฏู | ูููุฉ ุงููุฑูุฑ | tenant_id | ุงููุตู |
|------|--------------|-------------|-----------|-------|
| **Super Admin** | `superadmin` | `Super@2025` | NULL | ูุฏูุฑ ุงููุธุงู ุงููุงูู |
| **Company Admin** | `companyadmin` | `Company@2025` | 1 | ูุฏูุฑ ุดุฑูุฉ ุงูุชูููู ุงูุฃููู |
| **Supervisor** | `supervisor` | `Supervisor@2025` | 1 | ูุดุฑู (ูุฑุงุกุฉ ููุท) |
| **Employee** | `employee` | `Employee@2025` | 1 | ููุธู ุนุงุฏู |

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### **1. ูุดุงูู ุชู ุญููุง**:
- โ ุฅุตูุงุญ ุฃุฒุฑุงุฑ ุงูุชุนุฏูู/ุงูุญุฐู ูู `/admin/users`
- โ ุฅุถุงูุฉ routes ูุงููุฉ ููู CRUD
- โ ุญู ูุดููุฉ `tenant_id = "null"` (string) โ NULL (integer)
- โ ุฅูุดุงุก 4 ูุณุชุฎุฏููู ุงุฎุชุจุงุฑ ูุน ุฃุฏูุงุฑ ูุงุถุญุฉ

### **2. ุงูููุงู ุงููุชุจููุฉ**:
- โณ ุฅูุดุงุก ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงููุณุชุฎุฏู (`/admin/users/:id/permissions`)
- โณ ุชุตููู ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ (`/admin/roles`)
- โณ ุฅูุดุงุก ูุงุฌูุฉ ุฅุถุงูุฉ/ุชุนุฏูู ุฏูุฑ (`/admin/roles/new`, `/admin/roles/:id/edit`)
- โณ ุฅูุดุงุก ูุงุฌูุฉ ุชุฎุตูุต ุตูุงุญูุงุช ููู ุฏูุฑ (`/admin/roles/:id/permissions`)

### **3. ุงูุฃูุงู**:
- ุฌููุน ุงูู routes ูุญููุฉ ุจู `getUserInfo()` ูููุชุฑุฉ `tenant_id`/`assigned_to`
- ูููุงุช ุงููุฑูุฑ ูุฎุฒูุฉ ุจูุต ุตุฑูุญ (ูููุตูุญ ุจู hashing ูุงุญูุงู)
- ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูุชู ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐ ุฅุญุตุงุฆูุงุช ุงููุดุฑูุน

- **ุนุฏุฏ ุงููููุงุช ุงูููุนุฏูููุฉ**: 4
- **ุนุฏุฏ ุงูุฃุณุทุฑ ุงูููุถุงูุฉ**: 957+
- **ุนุฏุฏ ุงูู Routes ุงูุฌุฏูุฏุฉ**: 5 (view, edit form, edit handler, delete, delete confirmation)
- **ุนุฏุฏ ุงูู Migrations**: 3 (0012, 0013, 0014)
- **ุนุฏุฏ ุงููุณุชุฎุฏููู ุงูุงุฎุชุจุงุฑููู**: 4

---

## ๐ ุฑูุงุจุท ูููุฉ

- **GitHub Repo**: https://github.com/basealsyed2015-source/Expense-Master
- **Branch**: `genspark_ai_developer`
- **Commit**: `b590889` - "feat: Complete User Management with CRUD Operations"

- **Live URL (Sandbox)**: https://8080-iwirje2zy3fybezv7hkxu-b32ec7bb.sandbox.novita.ai
- **Login Page**: https://8080-iwirje2zy3fybezv7hkxu-b32ec7bb.sandbox.novita.ai/login
- **Users Page**: https://8080-iwirje2zy3fybezv7hkxu-b32ec7bb.sandbox.novita.ai/admin/users

---

## โ ุงูุฎูุงุตุฉ

ุชู **ุฅุนุงุฏุฉ ุจูุงุก ุงููุธุงู ูู ุงูุตูุฑ** ูุชูููุฐ:
1. โ **4 ุฃุฏูุงุฑ ูุงุถุญุฉ** (Super Admin, Company Admin, Supervisor, Employee)
2. โ **ูุธุงู CRUD ูุงูู** ูููุณุชุฎุฏููู (ุนุฑุถุ ุชุนุฏููุ ุญุฐู)
3. โ **4 ูุณุชุฎุฏููู ุงุฎุชุจุงุฑ** ุฌุงูุฒูู ููุงุฎุชุจุงุฑ
4. โ **Migrations ุฌุงูุฒุฉ** ูููุดุฑ ุนูู Hostinger
5. โ **ููุชุฑุฉ tenant_id** ุนูู ุฌููุน ุงูุจูุงูุงุช
6. โ **ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ** ูููุดุฑููู (Read-Only)

**ุงูุญุงูุฉ**: โ **ุฌุงูุฒ ูููุดุฑ 100%**

---

๐ **ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025-12-21  
๐จโ๐ป **ุงููุทูุฑ**: GenSpark AI Developer  
๐ง **ุงูุฅุตุฏุงุฑ**: v2.0 - Complete Permissions Rebuild
